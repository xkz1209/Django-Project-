{% extends 'flights/base.html' %}
{% block title %}Home{% endblock %}
{% block content %}

<!-- Heading for the My Orders section -->
<h2>My Orders</h2>

<!-- Check if there are any tickets to display -->
{% if tickets %}
<table class="table table-striped table-dark">
    <thead>
        <tr>
            <th>Flight Number</th>
            <th>Destination</th>
            <th>Departure</th>
            <th>Price</th>
            <th>Departure Time</th>
            <th>Quantity</th>
            <th>Total Price</th>
            <th>Order Date</th>
            <th>Check In</th>
            <th>Status</th>
            <th>Baggage</th>
        </tr>
    </thead>
    <tbody>
        {% for ticket in tickets %}
        <!-- Each row represents a single ticket -->
        <tr id="ticket-{{ticket.id}}">
            <!-- Highlight flight number and check-in column green if checked in -->
            <td {% if ticket.checked_in %} style="background-color:#80ff80;"{% endif %}>
                {{ ticket.flight.flight_num }}
            </td>
            <td>{{ ticket.flight.destination }}</td>
            <td>{{ ticket.flight.departure }}</td>
            <td>{{ ticket.flight.price }}</td>
            <td>{{ ticket.flight.departure_time }}</td>
            <td>{{ ticket.quantity }}</td>
            <td>{{ ticket.total_price }}</td>
            <td>{{ ticket.order_placed_date }}</td>
            <td {% if ticket.checked_in %} style="background-color:#80ff80;"{% endif %}>
                {% if not ticket.checked_in %}
                    <!-- Button to allow checking in if not already checked in -->
                    <a href="{% url 'check_in' ticket.id %}" class="btn btn-primary">Check In</a>
                {% else %}
                    <!-- Display seat numbers if checked in -->
                    Seats: 
                    {% for seat in ticket.seat_number %}
                        {{ seat }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                {% endif %}
            </td>
            <td>
                <!-- Display status badge indicating whether checked in or not -->
                {% if ticket.checked_in %}
                    <span class="badge bg-success">Checked In</span>
                {% else %}
                    <span class="badge bg-secondary">Not Checked In</span>
                {% endif %}
            </td>
            <td>
                <!-- Button to show baggage information -->
                <a href="{% url 'baggage' ticket.id %}" class="btn btn-info">Show</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<!-- Message displayed when no orders are found -->
<p>No orders found.</p>
{% endif %}

{% endblock %}